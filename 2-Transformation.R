library(dplyr)

#Integrando dados de municipios

DadosGravidez2021 <- DadosGravidez2021 %>%
  left_join(Municipios %>% 
              group_by(CODMUNIC) %>% 
              slice(1) %>% 
              ungroup() %>% 
              select(CODMUNIC, uf_code),
            by = c("CODMUNNASC" = "CODMUNIC")) %>%
  rename(UF = uf_code)

View(DadosGravidez2021)
#Filtrando valores de parto n達o informados

DadosGravidez2021 <- DadosGravidez2021[DadosGravidez2021$PARTO != 9, ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$PARTO), ]

#Filtrando valores nulos para colunas que ser達o utilizadas
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$ESCMAE), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$ESTCIVMAE), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$RACACORMAE), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$IDADEMAE), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$GRAVIDEZ), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$UF), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$QTDPARTCES), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$QTDPARTNOR), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$PARIDADE), ]
DadosGravidez2021 <- DadosGravidez2021[!is.na(DadosGravidez2021$GRAVIDEZ), ]


#Filtrando valores n達o informados para colunas que ser達o utilizadas

DadosGravidez2021 <- DadosGravidez2021[DadosGravidez2021$ESCMAE != 9, ]
DadosGravidez2021 <- DadosGravidez2021[DadosGravidez2021$ESTCIVMAE != 9, ]
DadosGravidez2021 <- DadosGravidez2021[DadosGravidez2021$GRAVIDEZ != 9, ]
DadosGravidez2021 <- DadosGravidez2021[DadosGravidez2021$LOCNASC != 9, ]

#Criando novas colunas

DadosGravidez2021 <- DadosGravidez2021 %>% mutate(MAIORIDADE = ifelse(IDADEMAE > 19, 1, 0))
DadosGravidez2021 <- DadosGravidez2021 %>% mutate(JA_TEVE_PARTO_CESARIA = ifelse(QTDPARTCES == "00", 0, 1))
DadosGravidez2021 <- DadosGravidez2021 %>% mutate(JA_TEVE_PARTO_VAGINAL = ifelse(QTDPARTNOR == "00", 0, 1))
DadosGravidez2021 <- DadosGravidez2021 %>%
  mutate(FAIXAETARIA = sapply(IDADEMAE, separaFaixaEtaria))

#Variavel dependente
DadosGravidez2021$PARTO <- as.factor(DadosGravidez2021$PARTO)

#Variavel independente
DadosGravidez2021$ESCMAE = as.factor(DadosGravidez2021$ESCMAE)
DadosGravidez2021$ESTCIVMAE = as.factor(DadosGravidez2021$ESTCIVMAE)
DadosGravidez2021$RACACORMAE = as.factor(DadosGravidez2021$RACACORMAE)
DadosGravidez2021$LOCNASC = as.factor(DadosGravidez2021$LOCNASC)
DadosGravidez2021$FAIXAETARIA = as.factor(DadosGravidez2021$FAIXAETARIA)
DadosGravidez2021$GRAVIDEZ = as.factor(DadosGravidez2021$GRAVIDEZ)
DadosGravidez2021$PARIDADE = as.factor(DadosGravidez2021$PARIDADE)
DadosGravidez2021$ESTCIVMAE = as.factor(DadosGravidez2021$ESTCIVMAE)
DadosGravidez2021$UF = as.factor(DadosGravidez2021$UF)
DadosGravidez2021$JA_TEVE_PARTO_CESARIA = as.factor(DadosGravidez2021$JA_TEVE_PARTO_CESARIA)
DadosGravidez2021$JA_TEVE_PARTO_VAGINAL = as.factor(DadosGravidez2021$JA_TEVE_PARTO_VAGINAL)

#Separando valores de teste e treinamento
NumerosLinhasTeste <- sample(1:nrow(DadosGravidez2021), 0.7 * nrow(DadosGravidez2021))
DadosGravidez2021Treinamento <- DadosGravidez2021[NumerosLinhasTeste, ]
DadosGravidez2021Teste <- DadosGravidez2021[-NumerosLinhasTeste, ]
